---
title: "PRT_data_analysis"
output: html_document
---

```{r}
# let's start by loading the relevant packages
library(here)
library(tidyverse)
library(janitor)
library(corrr)
library(ggplot2)
library(kableExtra)
library(ggthemes)
library(plotrix)
library(car)
library(optimx)
library(lme4)
library(patchwork)
library(qualtRics)

# and then let's read in the data
full.data = read_csv(here("data/combined.data.final.csv"))
```

Let's set the contrasts for all of the models

```{r}
full.data = full.data %>% 
  mutate(race_id = as.factor(race_id),
         time = as.factor(time))
contrasts(full.data$race_id) <- c(-1, 1)
contrasts(full.data$time) <- c(-1, 1)
```

Now let's do the data analysis, starting with the conversation data

```{r}
# first, who is talking about race
race.talk.model1 = glm(race_talk ~ 1 + kid_age + race_id + time + gender_code + 
                         kid_gender_code + education + age + pol_views + status_1,
                       family = "binomial",  
                       data = full.data)
race.talk.model1 %>% summary()

race.talk.model2 = glm(race_talk ~ 1 + kid_age + race_id * time + gender_code + 
                         kid_gender_code + education + age + pol_views + status_1,
                       family = "binomial",  
                       data = full.data)
race.talk.model2 %>% summary()

anova(race.talk.model1, race.talk.model2, test = "LRT")

# race.talk.model1 is the best, so let's now figure out what the main effects are
Anova(race.talk.model1, 
      type = "II",
      test.statistic = "LR")

# now racial inequality
racineq.talk.model1 = glm(rac_ineq_talk ~ 1 + kid_age + race_id + time + gender_code + 
                         kid_gender_code + education + age + pol_views + status_1,
                       family = "binomial",  
                       data = full.data)
racineq.talk.model1 %>% summary()

racineq.talk.model2 = glm(rac_ineq_talk ~ 1 + kid_age + race_id * time + gender_code + 
                         kid_gender_code + education + age + pol_views + status_1,
                       family = "binomial",  
                       data = full.data)
racineq.talk.model2 %>% summary()

anova(racineq.talk.model1, racineq.talk.model2, test = "LRT")

# racineq.talk.model2 is the best, so let's now figure out what the main effects are
Anova(racineq.talk.model2, 
      type = "III",
      test.statistic = "LR")

# and finally racial identity
raceid.talk.model1 = glm(raceid_talk ~ 1 + kid_age + race_id + time + gender_code + 
                         kid_gender_code + education + age + pol_views + status_1,
                       family = "binomial",  
                       data = full.data)
raceid.talk.model1 %>% summary()

raceid.talk.model2 = glm(raceid_talk ~ 1 + kid_age + race_id * time + gender_code + 
                         kid_gender_code + education + age + pol_views + status_1,
                       family = "binomial",  
                       data = full.data)
raceid.talk.model2 %>% summary()

anova(raceid.talk.model1, raceid.talk.model2, test = "LRT")

# raceid.talk.model2 is the best, so let's now figure out what the main effects are
Anova(raceid.talk.model2, 
      type = "III",
      test.statistic = "LR")

```

Let's then move to direct comparisons for each of the above

```{r}
# first for race

# first comparing White parents at time 1 and 2
racetalk.wy = full.data %>% 
  select(race_id, time, race_talk) %>% 
  filter(race_id == 0) %>% 
  group_by(time) %>% 
  summarise(yes = n() * mean(race_talk))

racetalk.wt = full.data %>% 
  select(race_id, time, race_talk) %>% 
  filter(race_id == 0) %>% 
  group_by(time) %>% 
  summarise(total = n())

prop.test(racetalk.wy$yes, racetalk.wt$total)

# then comparing Black parents at time 1 and 2
racetalk.by = full.data %>% 
  select(race_id, time, race_talk) %>% 
  filter(race_id == 1) %>% 
  group_by(time) %>% 
  summarise(yes = n() * mean(race_talk))

racetalk.bt = full.data %>% 
  select(race_id, time, race_talk) %>% 
  filter(race_id == 1) %>% 
  group_by(time) %>% 
  summarise(total = n())

prop.test(racetalk.by$yes, racetalk.bt$total)

# now White and Black parents at time 1
racetalk.t1y = full.data %>% 
  select(race_id, time, race_talk) %>% 
  filter(time == 1) %>% 
  group_by(race_id) %>% 
  summarise(yes = n() * mean(race_talk))

racetalk.t1t = full.data %>% 
  select(race_id, time, race_talk) %>% 
  filter(time == 1) %>% 
  group_by(race_id) %>% 
  summarise(total = n())

prop.test(racetalk.t1y$yes, racetalk.t1t$total)

# now White and Black parents at time 2
racetalk.t2y = full.data %>% 
  select(race_id, time, race_talk) %>% 
  filter(time == 2) %>% 
  group_by(race_id) %>% 
  summarise(yes = n() * mean(race_talk))

racetalk.t2t = full.data %>% 
  select(race_id, time, race_talk) %>% 
  filter(time == 2) %>% 
  group_by(race_id) %>% 
  summarise(total = n())

prop.test(racetalk.t2y$yes, racetalk.t2t$total)

# now for racial inequality

# first comparing White parents at time 1 and 2
racineqtalk.wy = full.data %>% 
  select(race_id, time, rac_ineq_talk) %>% 
  filter(race_id == 0) %>% 
  group_by(time) %>% 
  summarise(yes = n() * mean(rac_ineq_talk))

racineqtalk.wt = full.data %>% 
  select(race_id, time, rac_ineq_talk) %>% 
  filter(race_id == 0) %>% 
  group_by(time) %>% 
  summarise(total = n())

prop.test(racineqtalk.wy$yes, racineqtalk.wt$total)

# then comparing Black parents at time 1 and 2
racineqtalk.by = full.data %>% 
  select(race_id, time, rac_ineq_talk) %>% 
  filter(race_id == 1) %>% 
  group_by(time) %>% 
  summarise(yes = n() * mean(rac_ineq_talk))

racineqtalk.bt = full.data %>% 
  select(race_id, time, rac_ineq_talk) %>% 
  filter(race_id == 1) %>% 
  group_by(time) %>% 
  summarise(total = n())

prop.test(racineqtalk.by$yes, racineqtalk.bt$total)

# now White and Black parents at time 1
racineqtalk.t1y = full.data %>% 
  select(race_id, time, rac_ineq_talk) %>% 
  filter(time == 1) %>% 
  group_by(race_id) %>% 
  summarise(yes = n() * mean(rac_ineq_talk))

racineqtalk.t1t = full.data %>% 
  select(race_id, time, rac_ineq_talk) %>% 
  filter(time == 1) %>% 
  group_by(race_id) %>% 
  summarise(total = n())

prop.test(racineqtalk.t1y$yes, racineqtalk.t1t$total)

# now White and Black parents at time 2
racineqtalk.t2y = full.data %>% 
  select(race_id, time, rac_ineq_talk) %>% 
  filter(time == 2) %>% 
  group_by(race_id) %>% 
  summarise(yes = n() * mean(rac_ineq_talk))

racineqtalk.t2t = full.data %>% 
  select(race_id, time, rac_ineq_talk) %>% 
  filter(time == 2) %>% 
  group_by(race_id) %>% 
  summarise(total = n())

prop.test(racineqtalk.t2y$yes, racineqtalk.t2t$total)

# and now racial identity

# first comparing White parents at time 1 and 2
raceidtalk.wy = full.data %>% 
  select(race_id, time, raceid_talk) %>% 
  filter(race_id == 0) %>% 
  group_by(time) %>% 
  summarise(yes = n() * mean(raceid_talk))

raceidtalk.wt = full.data %>% 
  select(race_id, time, raceid_talk) %>% 
  filter(race_id == 0) %>% 
  group_by(time) %>% 
  summarise(total = n())

prop.test(raceidtalk.wy$yes, raceidtalk.wt$total)

# then comparing Black parents at time 1 and 2
raceidtalk.by = full.data %>% 
  select(race_id, time, raceid_talk) %>% 
  filter(race_id == 1) %>% 
  group_by(time) %>% 
  summarise(yes = n() * mean(raceid_talk))

raceidtalk.bt = full.data %>% 
  select(race_id, time, raceid_talk) %>% 
  filter(race_id == 1) %>% 
  group_by(time) %>% 
  summarise(total = n())

prop.test(raceidtalk.by$yes, raceidtalk.bt$total)

# now White and Black parents at time 1
raceidtalk.t1y = full.data %>% 
  select(race_id, time, raceid_talk) %>% 
  filter(time == 1) %>% 
  group_by(race_id) %>% 
  summarise(yes = n() * mean(raceid_talk))

raceidtalk.t1t = full.data %>% 
  select(race_id, time, raceid_talk) %>% 
  filter(time == 1) %>% 
  group_by(race_id) %>% 
  summarise(total = n())

prop.test(raceidtalk.t1y$yes, raceidtalk.t1t$total)

# now White and Black parents at time 2
raceidtalk.t2y = full.data %>% 
  select(race_id, time, raceid_talk) %>% 
  filter(time == 2) %>% 
  group_by(race_id) %>% 
  summarise(yes = n() * mean(raceid_talk))

raceidtalk.t2t = full.data %>% 
  select(race_id, time, raceid_talk) %>% 
  filter(time == 2) %>% 
  group_by(race_id) %>% 
  summarise(total = n())

prop.test(raceidtalk.t2y$yes, raceidtalk.t2t$total)
```

Next let's look at the frequency data

```{r}
# first for the race
race.convfreq.model1 = lm(race_convo_freq ~ 1 + kid_age + race_id + time + gender_code 
                          + kid_gender_code + education + age + pol_views + status_1,
                          data = full.data)
race.convfreq.model1 %>% summary()

race.convfreq.model2 = lm(race_convo_freq ~ 1 + kid_age + race_id * time + gender_code 
                          + kid_gender_code + education + age + pol_views + status_1,
                          data = full.data)
race.convfreq.model2 %>% summary()

anova(race.convfreq.model1, race.convfreq.model2, test = "LRT")

# race.convfreq.model2 is the best, so let's now figure out what the main effects are
Anova(race.convfreq.model2, 
      type = "III",
      test.statistic = "LR")

# then for racial inequality
racineq.convfreq.model1 = lm(rac_ineq_convo_freq ~ 1 + kid_age + race_id + time +
                             gender_code + kid_gender_code + education + age + pol_views
                             + status_1,
                          data = full.data)
racineq.convfreq.model1 %>% summary()

racineq.convfreq.model2 = lm(rac_ineq_convo_freq ~ 1 + kid_age + race_id * time +
                             gender_code + kid_gender_code + education + age + pol_views
                             + status_1,
                          data = full.data)
racineq.convfreq.model2 %>% summary()

anova(racineq.convfreq.model1, racineq.convfreq.model2, test = "LRT")

# racineq.convfreq.model2 is the best, so let's now figure out what the main effects are
Anova(racineq.convfreq.model2, 
      type = "III",
      test.statistic = "LR")

# and finally for racial identity
raceid.convfreq.model1 = lm(raceid_convo_freq ~ 1 + kid_age + race_id + time +
                              gender_code + kid_gender_code + education + age + 
                              pol_views + status_1,
                          data = full.data)
raceid.convfreq.model1 %>% summary()

raceid.convfreq.model2 = lm(raceid_convo_freq ~ 1 + kid_age + race_id * time +
                              gender_code + kid_gender_code + education + age + 
                              pol_views + status_1,
                          data = full.data)
raceid.convfreq.model2 %>% summary()

anova(raceid.convfreq.model1, raceid.convfreq.model2, test = "LRT")

# raceid.convfreq.model2 is the best, so let's now figure out what the main effects are
Anova(raceid.convfreq.model2, 
      type = "III",
      test.statistic = "LR")

# I also just want counts of how many parents talked about each topic
full.data %>% 
  filter(race_talk == 1) %>% 
  group_by(race_id, time) %>% 
  count()

full.data %>% 
  filter(rac_ineq_talk == 1) %>% 
  group_by(race_id, time) %>% 
  count()

full.data %>% 
  filter(raceid_talk == 1) %>% 
  group_by(race_id, time) %>% 
  count()
```

And let's run direct comparisons for the above

```{r}
# first for race

# first comparing White parents at time 1 and time 2
t.test(full.data %>% 
         filter(race_id == 0, 
                time == 1) %>% 
         select(race_convo_freq),
       full.data %>% 
         filter(race_id == 0, 
                time == 2) %>% 
         select(race_convo_freq))

# now comparing Black parents at time 1 and time 2
t.test(full.data %>% 
         filter(race_id == 1, 
                time == 1) %>% 
         select(race_convo_freq),
       full.data %>% 
         filter(race_id == 1, 
                time == 2) %>% 
         select(race_convo_freq))

# now comparing White and Black parents at time 1
t.test(full.data %>% 
         filter(race_id == 0, 
                time == 1) %>% 
         select(race_convo_freq),
       full.data %>% 
         filter(race_id == 1, 
                time == 1) %>% 
         select(race_convo_freq))

# and comparing White and Black parents at time 2
t.test(full.data %>% 
         filter(race_id == 0, 
                time == 2) %>% 
         select(race_convo_freq),
       full.data %>% 
         filter(race_id == 1, 
                time == 2) %>% 
         select(race_convo_freq))

# now for racial inequality

# first comparing White parents at time 1 and time 2
t.test(full.data %>% 
         filter(race_id == 0, 
                time == 1) %>% 
         select(rac_ineq_convo_freq),
       full.data %>% 
         filter(race_id == 0, 
                time == 2) %>% 
         select(rac_ineq_convo_freq))

# now comparing Black parents at time 1 and time 2
t.test(full.data %>% 
         filter(race_id == 1, 
                time == 1) %>% 
         select(rac_ineq_convo_freq),
       full.data %>% 
         filter(race_id == 1, 
                time == 2) %>% 
         select(rac_ineq_convo_freq))

# now comparing White and Black parents at time 1
t.test(full.data %>% 
         filter(race_id == 0, 
                time == 1) %>% 
         select(rac_ineq_convo_freq),
       full.data %>% 
         filter(race_id == 1, 
                time == 1) %>% 
         select(rac_ineq_convo_freq))

# and comparing White and Black parents at time 2
t.test(full.data %>% 
         filter(race_id == 0, 
                time == 2) %>% 
         select(rac_ineq_convo_freq),
       full.data %>% 
         filter(race_id == 1, 
                time == 2) %>% 
         select(rac_ineq_convo_freq))

# and finally for racial identity

# first comparing White parents at time 1 and time 2
t.test(full.data %>% 
         filter(race_id == 0, 
                time == 1) %>% 
         select(raceid_convo_freq),
       full.data %>% 
         filter(race_id == 0, 
                time == 2) %>% 
         select(raceid_convo_freq))

# now comparing Black parents at time 1 and time 2
t.test(full.data %>% 
         filter(race_id == 1, 
                time == 1) %>% 
         select(raceid_convo_freq),
       full.data %>% 
         filter(race_id == 1, 
                time == 2) %>% 
         select(raceid_convo_freq))

# now comparing White and Black parents at time 1
t.test(full.data %>% 
         filter(race_id == 0, 
                time == 1) %>% 
         select(raceid_convo_freq),
       full.data %>% 
         filter(race_id == 1, 
                time == 1) %>% 
         select(raceid_convo_freq))

# and comparing White and Black parents at time 2
t.test(full.data %>% 
         filter(race_id == 0, 
                time == 2) %>% 
         select(raceid_convo_freq),
       full.data %>% 
         filter(race_id == 1, 
                time == 2) %>% 
         select(raceid_convo_freq))
```

Now let's look at the worry questions

```{r}
# first worry of child being a target of bias
worry.target.model1 = lm(child_bias_target ~ 1 + kid_age + race_id + time + gender_code
                        + kid_gender_code + education + age + pol_views + status_1,
                        data = full.data)
worry.target.model1 %>% summary()

worry.target.model2 = lm(child_bias_target ~ 1 + kid_age + race_id * time + gender_code
                        + kid_gender_code + education + age + pol_views + status_1,
                        data = full.data)
worry.target.model2 %>% summary()

anova(worry.target.model1, worry.target.model2, test = "LRT")

# model 2 is the best, so let's now figure out what the main effects are
Anova(worry.target.model2, 
      type = "III",
      test.statistic = "LR")

# then worry of child being biased
worry.is.bias.model1 = lm(child_become_bias ~ 1 + kid_age + race_id + time + gender_code
                        + kid_gender_code + education + age + pol_views + status_1,
                        data = full.data)
worry.is.bias.model1 %>% summary()

worry.is.bias.model2 = lm(child_become_bias ~ 1 + kid_age + race_id * time + gender_code
                        + kid_gender_code + education + age + pol_views + status_1,
                        data = full.data)
worry.is.bias.model2 %>% summary()

anova(worry.is.bias.model1, worry.is.bias.model2, test = "LRT")

# model 1 is the best, so let's now figure out what the main effects are
Anova(worry.is.bias.model1, 
      type = "II",
      test.statistic = "LR")
```

And the direct comparisons for the above

```{r}
# let's start with worry of being a target

# first comparing White parents at time 1 and time 2
t.test(full.data %>% 
         filter(race_id == 0, 
                time == 1) %>% 
         select(child_bias_target),
       full.data %>% 
         filter(race_id == 0, 
                time == 2) %>% 
         select(child_bias_target))

# now comparing Black parents at time 1 and time 2
t.test(full.data %>% 
         filter(race_id == 1, 
                time == 1) %>% 
         select(child_bias_target),
       full.data %>% 
         filter(race_id == 1, 
                time == 2) %>% 
         select(child_bias_target))

# now comparing White and Black parents at time 1
t.test(full.data %>% 
         filter(race_id == 0, 
                time == 1) %>% 
         select(child_bias_target),
       full.data %>% 
         filter(race_id == 1, 
                time == 1) %>% 
         select(child_bias_target))

# and comparing White and Black parents at time 2
t.test(full.data %>% 
         filter(race_id == 0, 
                time == 2) %>% 
         select(child_bias_target),
       full.data %>% 
         filter(race_id == 1, 
                time == 2) %>% 
         select(child_bias_target))

# now looking at worry of being biased

# first comparing White parents at time 1 and time 2
t.test(full.data %>% 
         filter(race_id == 0, 
                time == 1) %>% 
         select(child_become_bias),
       full.data %>% 
         filter(race_id == 0, 
                time == 2) %>% 
         select(child_become_bias))

# now comparing Black parents at time 1 and time 2
t.test(full.data %>% 
         filter(race_id == 1, 
                time == 1) %>% 
         select(child_become_bias),
       full.data %>% 
         filter(race_id == 1, 
                time == 2) %>% 
         select(child_become_bias))

# now comparing White and Black parents at time 1
t.test(full.data %>% 
         filter(race_id == 0, 
                time == 1) %>% 
         select(child_become_bias),
       full.data %>% 
         filter(race_id == 1, 
                time == 1) %>% 
         select(child_become_bias))

# and comparing White and Black parents at time 2
t.test(full.data %>% 
         filter(race_id == 0, 
                time == 2) %>% 
         select(child_become_bias),
       full.data %>% 
         filter(race_id == 1, 
                time == 2) %>% 
         select(child_become_bias))
```

Let's look at the percentages for the qualitative data, collapsed across topic

```{r}
# let's get the data we want
collapsed.data = full.data %>% 
  rename_with(.fn = ~str_replace(., "rac_ineq", "inequality"),
              .cols = contains("rac_ineq")) %>% 
  pivot_longer(cols = race_colorblindness_code:raceid_no_code, 
               names_to = c("topic", "code", "delete"),
               names_sep = "_") %>% 
  mutate(race_dummy = ifelse(topic == "race", race_talk, 0),
         inequality_dummy = ifelse(topic == "inequality", inequality_talk, 0),
         raceid_dummy = ifelse(topic == "raceid", raceid_talk, 0),
         include = race_dummy + inequality_dummy + raceid_dummy)

# and look at the relevant percentages
collapsed.data %>% 
  filter(code == "colorblindness" | code == "preparation") %>% 
  group_by(code, race_id, time) %>% 
  summarise(percentage = 100 * mean(value, na.rm = T)) %>% 
  kable(digits = 1) %>% 
  kable_styling(bootstrap_options = "striped",
                full_width = F)
```


Now let's do the qualitative analysis, collapsed across topic

```{r}
# let's start with colorblindness
overall.cb.model1 = glmer(value ~ 1 + kid_age + race_id + time + gender_code +
                       kid_gender_code + education + age + pol_views + status_1 + 
                         (1 | sub_id),
                     family = "binomial",
                     control = glmerControl(optimizer = "bobyqa"),
                     data = collapsed.data %>% 
                         filter(include == 1,
                                code == "colorblindness"))
overall.cb.model1 %>% summary()

overall.cb.model2 = glmer(value ~ 1 + kid_age + race_id * time + gender_code +
                       kid_gender_code + education + age + pol_views + status_1 +
                         (1 | sub_id),
                     family = "binomial",  
                     control = glmerControl(optimizer = "bobyqa"),
                     data = collapsed.data %>% 
                         filter(include == 1,
                                code == "colorblindness"))
overall.cb.model2 %>% summary()

anova(overall.cb.model1, overall.cb.model2, test = "LRT")

# model 1 is the best, so let's see what the main effects are
Anova(overall.cb.model1, 
      type = "II",
      test.statistic = "Chisq")

# now preparation for bias
overall.prep.model1 = glmer(value ~ 1 + kid_age + race_id + time + gender_code +
                       kid_gender_code + education + age + pol_views + status_1 +
                         (1 | sub_id),
                     family = "binomial", 
                     control = glmerControl(optimizer = "bobyqa"),
                     data = collapsed.data %>% 
                         filter(include == 1,
                                code == "preparation"))
overall.prep.model1 %>% summary()

overall.prep.model2 = glmer(value ~ 1 + kid_age + race_id * time + gender_code +
                       kid_gender_code + education + age + pol_views + status_1 +
                         (1 | sub_id),
                     family = "binomial",
                     control = glmerControl(optimizer = "bobyqa"),
                     data = collapsed.data %>% 
                         filter(include == 1,
                                code == "preparation"))
overall.prep.model2 %>% summary()

anova(overall.prep.model1, overall.prep.model2, test = "LRT")

# model 2 is the best, so let's see what the main effects are
Anova(overall.prep.model2, 
      type = "III",
      test.statistic = "Chisq")
```

And the direct comparisons for the above

```{r}
# starting with preparation for bias

# first comparing White parents at time 1 and 2
prep.wy = collapsed.data %>% 
  filter(!is.na(value), 
         code == "preparation") %>% 
  select(race_id, time, value) %>% 
  filter(race_id == 0) %>% 
  group_by(time) %>% 
  summarise(yes = sum(value))

prep.wt = collapsed.data %>% 
  filter(!is.na(value), 
         code == "preparation") %>% 
  select(race_id, time, race_talk) %>% 
  filter(race_id == 0) %>% 
  group_by(time) %>% 
  summarise(total = n())

prop.test(prep.wy$yes, prep.wt$total)

# then comparing Black parents at time 1 and 2
prep.by = collapsed.data %>% 
  filter(!is.na(value), 
         code == "preparation") %>% 
  select(sub_id, race_id, time, value) %>% 
  filter(race_id == 1) %>% 
  group_by(time) %>% 
  summarise(yes = sum(value))

prep.bt = collapsed.data %>% 
  filter(!is.na(value), 
         code == "preparation") %>% 
  select(race_id, time, race_talk) %>% 
  filter(race_id == 1) %>% 
  group_by(time) %>% 
  summarise(total = n())

prop.test(prep.by$yes, prep.bt$total)

# now White and Black parents at time 1
prep.t1y = collapsed.data %>% 
  filter(!is.na(value), 
         code == "preparation") %>% 
  select(sub_id, race_id, time, value) %>% 
  filter(time == 1) %>% 
  group_by(race_id) %>% 
  summarise(yes = sum(value))

prep.t1t = collapsed.data %>% 
  filter(!is.na(value), 
         code == "preparation") %>% 
  select(sub_id, race_id, time, value) %>% 
  filter(time == 1) %>% 
  group_by(race_id) %>% 
  summarise(total = n())

prop.test(prep.t1y$yes, prep.t1t$total)

# now White and Black parents at time 2
prep.t2y = collapsed.data %>% 
  filter(!is.na(value), 
         code == "preparation") %>% 
  select(sub_id, race_id, time, value) %>% 
  filter(time == 2) %>% 
  group_by(race_id) %>% 
  summarise(yes = sum(value))

prep.t2t = collapsed.data %>% 
  filter(!is.na(value), 
         code == "preparation") %>% 
  select(sub_id, race_id, time, value) %>% 
  filter(time == 2) %>% 
  group_by(race_id) %>% 
  summarise(total = n())

prop.test(prep.t2y$yes, prep.t2t$total)

# now colorblindness code

# first comparing White parents at time 1 and 2
ce.wy = collapsed.data %>% 
  filter(!is.na(value), 
         code == "ce") %>% 
  select(race_id, time, value) %>% 
  filter(race_id == 0) %>% 
  group_by(time) %>% 
  summarise(yes = sum(value))

ce.wt = collapsed.data %>% 
  filter(!is.na(value), 
         code == "ce") %>% 
  select(race_id, time, race_talk) %>% 
  filter(race_id == 0) %>% 
  group_by(time) %>% 
  summarise(total = n())

prop.test(ce.wy$yes, ce.wt$total)

# then comparing Black parents at time 1 and 2
ce.by = collapsed.data %>% 
  filter(!is.na(value), 
         code == "ce") %>% 
  select(sub_id, race_id, time, value) %>% 
  filter(race_id == 1) %>% 
  group_by(time) %>% 
  summarise(yes = sum(value))

ce.bt = collapsed.data %>% 
  filter(!is.na(value), 
         code == "ce") %>% 
  select(race_id, time, race_talk) %>% 
  filter(race_id == 1) %>% 
  group_by(time) %>% 
  summarise(total = n())

prop.test(ce.by$yes, ce.bt$total)

# now White and Black parents at time 1
ce.t1y = collapsed.data %>% 
  filter(!is.na(value), 
         code == "ce") %>% 
  select(sub_id, race_id, time, value) %>% 
  filter(time == 1) %>% 
  group_by(race_id) %>% 
  summarise(yes = sum(value))

ce.t1t = collapsed.data %>% 
  filter(!is.na(value), 
         code == "ce") %>% 
  select(sub_id, race_id, time, value) %>% 
  filter(time == 1) %>% 
  group_by(race_id) %>% 
  summarise(total = n())

prop.test(ce.t1y$yes, ce.t1t$total)

# now White and Black parents at time 2
ce.t2y = collapsed.data %>% 
  filter(!is.na(value), 
         code == "ce") %>% 
  select(sub_id, race_id, time, value) %>% 
  filter(time == 2) %>% 
  group_by(race_id) %>% 
  summarise(yes = sum(value))

ce.t2t = collapsed.data %>% 
  filter(!is.na(value), 
         code == "ce") %>% 
  select(sub_id, race_id, time, value) %>% 
  filter(time == 2) %>% 
  group_by(race_id) %>% 
  summarise(total = n())

prop.test(ce.t2y$yes, ce.t2t$total)

```


